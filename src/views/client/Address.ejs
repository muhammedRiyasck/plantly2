
<%- include('../layouts/client/header') %>

<style>
.form-control{
  background-color: rgb(222, 222, 255);
}
</style>

<div class="page-wrapper" id="reloadDiv">

   
  
    <main class="main mt-5">
  
          <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
              <div class="container">
                  <h1 class="page-title  text-black-50">My Address</h1>
              </div><!-- End .container -->
          </div><!-- End .page-header -->
  
          <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
              <div class="container">
                  <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="">Home</a></li>
                      <li class="breadcrumb-item active" aria-current="page">Address</li>
                  </ol>
              </div><!-- End .container -->
          </nav><!-- End .breadcrumb-nav -->
  
          <div class="page-content">
  
              <div class="dashboard">
          
                  <div class="container">
  
                      <div class="row">
  
                        <%- include('../layouts/client/profileNavbar') %>
  
                          <div class="col-md-8 col-lg-9">
  
                              <div class="tab-content">
  
                                  <!--address-->
  
                                  <div class="" id="tab-address">
  
                                    <div class="container-fluid px-3 d-flex justify-content-end ">
  
                                      <button type="button" class="btn btn-primary mb-3 " data-toggle="modal" data-target="#address" data-bs-whatever="@mdo">Add Address</button>
  
                                          <!-- Modal For Address Add-->
  
                                          <div class="modal fade" id="address" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">   <!-- Add Addres Modal -->
  
                                            <div class="modal-dialog">
                                              <div class="modal-content">
  
                                                <div class="modal-header">
                                                  <h6 class="modal-title " id="exampleModalLabel">Add Address</h6>
                                                 <button><type="button" class="btn-close" data-dismiss="modal" aria-label="Close">X</button>
                                                </div>
  
                                                <div class="modal-body">
  
                                                  <form method="post" style="padding-left: 15px;padding-right: 15px;" id="addform">
                                                      
                                                    <div class="row">
  
                                                    <div class="col-lg-6">
                                                        <label for="name" class="col-form-label text-black">Name *</label>
                                                        <input type="text" class="form-control" name="name" id="namee" placeholder="Enter your Name" required>
                                                    </div>
  
                                                    <div class="col-lg-6">
                                                        <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                        <input type="text" class="form-control" name="phone" id="phonee" placeholder="Enter your Mobile" required>
                                                    </div>
  
                                                    <div class="col-lg-6">
                                                        <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                        <input type="text" class="form-control" name="locality" id="localityy" placeholder="Enter your Locality" required>
                                                    </div>
  
                                                    <div class="col-lg-6">
                                                        <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                        <input type="text" class="form-control" name="pincode" id="pincodee" placeholder="Enter your pincode" required>
                                                    </div>
  
                                                    </div>
  
                                                    <div class="col-lg-12">
  
                                                      <label for="display-name" class="requird text-dark"  >Address *</label>
                                                      <textarea type="text" class="form-control " id="add" cols="" rows="3" placeholder="Enter your Address" name="address" required></textarea>
  
                                                    </div>
  
                                                    <div class="row mb-1">
  
                                                       <div class="col-lg-6">
                                                        <label for="city" class="col-form-label text-black">City *</label>
                                                        <input type="text" class="form-control" name="city" id="cityy" placeholder="Enter your City" required>
                                                    </div>
  
                                                    <div class="col-lg-6">
                                                        <label for="state" class="col-form-label text-black">State *</label>
                                                        <input type="text" class="form-control" name="state" id="statee" placeholder="Enter your State" required>
                                                    </div>
  
                                                    </div>
                                                    
                                                </form>
                                                
                                                </div>
  
                                                <div class="modal-footer">
  
                                                  <input type="hidden" value="<%= userId %>" id="validUserId">
                                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                  <button type="submit" class="btn btn-primary" onclick="validateForm();">Add</button>
  
                                                </div>
  
                                              </div>
                                            </div>
  
                                          </div>
  
                                      </div>
  
                                      <div class="row">
                                  <% if (address !== null && address.addressData.length !== 0) { %>
                                        
                                    <% for (let i = 0; i < address.addressData.length; i++) { %>
                                                                                                                                                                                                                                                                                 
  
                                          <div class="col-lg-5">
  
                                              <div class="card card-dashboard" style="margin-bottom: 1rem;">
  
                                                  <div class="card-body">
                                                    
                                                    <button type="button" class="close" aria-label="Close mb-2 " style="font-size: 23px;padding-bottom: 20px;" onclick="deleteAddress('<%= userId %>' , '<%= address.addressData[i]._id %>')">
                                                          <span aria-hidden="true">&times;</span>
                                                      </button>
  
                                                      <h3 class="card-title">Address</h3><!-- End .card-title -->
  
                                                           <p><span><%=address.addressData[i].name %></span></p> 
                                                           <p><span><%=address.addressData[i].address %></span>, 
                                                           <br><span><%= address.addressData[i].locality %>,</span> 
                                                           <span><%=address.addressData[i].state %>,</span> 
                                                           <span><%=address.addressData[i].city %>,</span> 
                                                           <span><%= address.addressData[i].pincode %> </span> 
                                                              <br>
                                                            <span>Phone: <%= address.addressData[i].phone %> </span>
                                                            </p>
  
                                                      <a herf="#" style="cursor: pointer; color: rgb(207, 149, 77);" data-toggle="modal" data-target="#editAddress" onclick="editAddress('<%= address.addressData[i]._id %>')">Edit<i class="icon-edit"></i></a>
  
                                                   </div><!-- End .card-body -->
  
                                              </div><!-- End .card-dashboard -->
  
                                          </div ><!-- End .col-lg-6 -->
  
                                          <!--Edit Addres Modal-->
  
                                                  <!-- Modal -->
  
                                                  <div class="modal fade" id="editAddress" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  
                                                    <div class="modal-dialog">
  
                                                      <div class="modal-content">
  
                                                        <div class="modal-header">
                                                          <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Address</h1>
                                                          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">X</button>
                                                        </div>
  
                                                        <div class="modal-body">
  
                                                          <form action="/addEditAddress" method="post" style="padding-left: 15px;padding-right: 15px;" id="editForm">
  
                                                            <p type="hiding" hidden id="message"><%=message %></p>
                                                          
                                                          <div class="row">
  
                                                          <div class="col-lg-6">
                                                              <label for="name" class="col-form-label text-black">Name *</label>
                                                              <input type="text" class="form-control" name="name" id="name" placeholder="Enter your Name" required>
                                                          </div>
  
                                                          <div class="col-lg-6">
                                                              <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                              <input type="text" class="form-control" name="phone" id="phone" placeholder="Enter your Mobile" required>
                                                          </div>
  
                                                          <div class="col-lg-6">
                                                              <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                              <input type="text" class="form-control" name="locality" id="locality" placeholder="Enter your Locality" required>
                                                          </div>
  
                                                          <div class="col-lg-6">
                                                              <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                              <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter your pincode" required>
                                                          </div>
  
                                                          </div>
  
                                                          <div class="col-lg-12">
  
                                                            <label for="display-name" class="requird text-dark"  >Address *</label>
                                                            <textarea type="text" style="color: rgb(128, 128, 128);"  id="addresss" class="form-control" rows="3" placeholder="Enter your Address" name="address" required></textarea>
  
                                                          </div>
  
                                                          <div class="row mb-1">
  
                                                            <div class="col-lg-6">
                                                              <label for="city" class="col-form-label text-black">City *</label>
                                                              <input type="text" class="form-control" name="city" id="city" placeholder="Enter your City" required>
                                                          </div>
  
                                                          <div class="col-lg-6">
                                                              <label for="state" class="col-form-label text-black">State *</label>
                                                              <input type="text" class="form-control" name="state" id="state" placeholder="Enter your State" required>
                                                          </div>
  
                                                          </div>
  
                                                          <input type="hidden" name="id" id="id">
                                                          
                                                          <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                            <button type="submit"  class="btn btn-primary">Save changes</button>
                                                          </div>
  
                                                      </form>
                                                                                                      
                                                        </div>
  
  
                                                      </div>
  
                                                    </div>
  
                                                  </div>
  
                                          <!-- <div class="col-lg-6">
                                              <div class="card card-dashboard">
                                                  <div class="card-body">
                                                      <h3 class="card-title">Shipping Address</h3>End .card-title
  
                                                      <p>You have not set up this type of address yet.<br>
                                                      <a href="#">Edit <i class="icon-edit"></i></a></p>
                                                  </div>End .card-body
                                              </div>End .card-dashboard
                                          </div>End .col-lg-6 -->
  
                                          
                                       <%  } %>
                                          
                                    <%} else{ %>
                                     
                                      <h5 style="margin-left: 24%;color: rgb(16, 16, 14);">can't see any address!!</h5>
                                   
                                      <% } %>
                                      
                                        </div><!-- End .row -->
                                                                   
                                  </div><!-- .End .tab-pane -->
  
                                  <!--address End-->
  
                              </div> <!--tab content-->
                          </div><!-- End .col-lg-9 -->
                      </div><!-- End .row -->
                  </div><!-- End .container -->
              </div><!-- End .dashboard -->
          </div><!-- End .page-content -->
  
      </main><!-- End .main -->
  
    <!-- End .main -->
  
    <!-- Connect Footer -->
  
<%- include('../layouts/client/footer') %>
    <!-- Connect Footer -->
  
  </div>
  
  <button id="scroll-top" title="Back to Top">
  
    <i class="icon-arrow-up"></i>
  
  </button>
  
  <!--Connect Mobaile View-->
  
  <!--Connect Mobaile View-->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Plugins JS File -->
   
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/jquery.hoverIntent.min.js"></script>
  <script src="assets/js/jquery.waypoints.min.js"></script>
  <script src="assets/js/superfish.min.js"></script>
  <script src="assets/js/owl.carousel.min.js"></script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  
  <script>
  
  //  Sweet Alert For Edit Address :-
  
  const message = document.getElementById('message');
  
    if(message.textContent == 'Address Edited'){
  
      Swal.fire({
       
        title:'Address Edited',
        text:'Address Edited Successfully',
        icon:'success',
        confirmButtonText: 'OK'
       
      })
  
    };
  
    //  Add Address Section :-
  
    function addAddress(id){

      console.log(id);
  
        const form = document.getElementById('addform');
  
        const formData = new FormData(form)
        const addressData = {}
        
        formData.forEach((value , key) => {
  
          addressData[key] = value;
          
        });
  
      fetch(`/address?id=${id}` , {method : 'put' , headers : {'Content-Type' : 'application/json'} , body:JSON.stringify({addressData})})
  
      .then(res => res.json()).then(data => {
  
        if(data.success){
  
          Swal.fire({
       
           title:'Address Added',
           text:'Address Added Successfully',
           icon:'success',
           confirmButtonText: 'OK'
       
          }).then((result) => {
   
            window.location.reload()
  
           
          })
  
        } else {
      
          Swal.fire({
          
            title:'Failed',
            text:'Address Adding Failed" (Already Exits)"',
            icon:'error',
            confirmButtonText: 'OK'
          
          })
          // .then((result) => {
      
          //  window.location.reload()
              
          // })
  
        }
  
      })
  
  };
  
  //  Delete Address :-
  
  function deleteAddress(id , addressId){
  
    Swal.fire({
  
    title: "Are you sure?",
    text: "Delete this address",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Yes, delete it!"
  
  }).then((result) => {
    
      if (result.isConfirmed) {
  
        Swal.fire({
  
          title: "Deleted!",
          text: "Your address has been deleted.",
          icon: "success"
  
        }).then(()=>{
  
          fetch(`/deleteAddress?id=${id}` , {method:"delete" ,headers:{'Content-Type':'application/json'},body:JSON.stringify({addressId})})
  
          .then(data =>{
  
            if(data.ok){
  
              window.location.reload()
  
              
            }
            
          })
  
        })
  
      }
  
    });
    
  }
  
  //  Edit Address :-
  
  function editAddress(addressId){
   console.log(addressId)
    const namee = document.getElementById('name')
    const phonee = document.getElementById('phone')
    const localityy = document.getElementById('locality')
    const pincodee = document.getElementById('pincode')
    const addressss = document.getElementById('addresss')
    const cityy = document.getElementById('city')
    const statee = document.getElementById('state')
    const idd = document.getElementById('id');
  
    fetch('/editAddress' , {method : 'put'  , headers : {'Content-Type': 'application/json'} , body : JSON.stringify({addressId})})
  
    .then((res) => res.json())
  
    .then((data) =>{
      console.log(data.editAddress.addressData[0])
      const {name , phone , locality , pincode , address , city , state , _id} = data.editAddress.addressData[0];

  
      namee.value = name
      phonee.value = phone
      pincodee.value = pincode
      localityy.value = locality
      addressss.value = address
      cityy.value = city
      statee.value = state
      idd.value = _id
  
    })
  
  };
  
  //  Validation For Add Address :-
  
  function validateForm() {
    
    const validId = document.getElementById('validUserId').value
    
    var inputs = document.getElementById("addform").querySelectorAll("input, textarea")
  
    var isValid = true
  
      inputs.forEach(function(input) {
  
        if (input.value.trim() === "") {
  
          isValid = false;
          return;
        }
  
      });
  
      if (!isValid) {
  
        event.preventDefault(); 
              
        Swal.fire({
  
          title: "Oops!!!",
          text: "Please Fill All Input Fields",
          icon: "error"
  
        })
  
      } else {
  
        var addressInput = document.getElementById("add")
  
        event.preventDefault();
  
        addAddress(validId);
      }
  
  }
  
  </script>
  